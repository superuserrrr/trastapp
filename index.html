<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrasteroApp - Gesti√≥n de Objetos Personales</title>
    <style>
        /* Reset y Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 50%, #eef2ff 100%);
            min-height: 100vh;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .w-4 {
            width: 1rem;
        }

        .h-4 {
            height: 1rem;
        }

        .w-5 {
            width: 1.25rem;
        }

        .h-5 {
            height: 1.25rem;
        }

        .w-8 {
            width: 2rem;
        }

        .h-8 {
            height: 2rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-center {
            text-align: center;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        /* Login Screen Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .login-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-icon {
            margin: 0 auto 1.5rem;
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .password-input-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
        }

        .password-toggle:hover {
            color: #374151;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .setup-message {
            background: #fffbeb;
            border: 1px solid #fed7aa;
            color: #d97706;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        /* Loading Styles */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #6b7280;
            font-weight: 500;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        .header-container {
            max-width: 80rem;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-icon {
            width: 3rem;
            height: 3rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .header-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-stats {
            display: flex;
            gap: 1.5rem;
        }

        .stats-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            opacity: 0.95;
        }

        .stats-number {
            font-weight: 600;
            color: #fbbf24;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Main Container */
        .main-container {
            max-width: 80rem;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .content {
            display: grid;
            gap: 2rem;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(229, 231, 235, 0.8);
            overflow: hidden;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }

        /* Form Styles */
        .form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            color: #374151;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
            border-color: transparent;
        }

        .form-input:disabled {
            background: #f3f4f6;
            cursor: not-allowed;
        }

        .form-input::placeholder {
            color: #9ca3af;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .btn-primary:hover:not(:disabled) {
            background: #1d4ed8;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f9fafb;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #f3f4f6;
        }

        .btn-full {
            width: 100%;
        }

        .btn-icon {
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            background: transparent;
        }

        .btn-icon.edit {
            color: #2563eb;
        }

        .btn-icon.edit:hover {
            color: #1d4ed8;
            background: #dbeafe;
        }

        .btn-icon.delete {
            color: #dc2626;
        }

        .btn-icon.delete:hover {
            color: #b91c1c;
            background: #fee2e2;
        }

        /* Search and Filter */
        .search-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            color: #374151;
        }

        /* Items List */
        .items-container {
            display: grid;
            gap: 0.75rem;
        }

        .item-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            transition: all 0.2s ease;
        }

        .item-card:hover {
            background: #f3f4f6;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .item-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
        }

        .item-actions {
            display: flex;
            gap: 0.25rem;
        }

        .item-location {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .item-date {
            color: #9ca3af;
            font-size: 0.75rem;
        }

        .edit-input {
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 0.5rem;
            padding: 0.5rem;
            font-size: 1rem;
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .edit-actions {
            display: flex;
            gap: 0.5rem;
        }

        .confirm-delete {
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1rem;
            color: #dc2626;
        }

        .confirm-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .confirm-btn {
            background: #dc2626;
            color: white;
        }

        .confirm-btn:hover {
            background: #b91c1c;
        }

        .cancel-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .cancel-btn:hover {
            background: #e5e7eb;
        }

        /* Export/Import Section */
        .export-import-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .export-btn, .import-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .export-btn {
            background: #10b981;
            color: white;
        }

        .export-btn:hover {
            background: #059669;
        }

        .import-btn {
            background: #8b5cf6;
            color: white;
        }

        .import-btn:hover {
            background: #7c3aed;
        }

        .file-input {
            display: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }

        .empty-state-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }

        /* Password Change Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .export-import-section {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .header-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .search-container {
                flex-direction: column;
            }

            .item-header {
                flex-direction: column;
                gap: 0.5rem;
            }

            .item-actions {
                justify-content: flex-start;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 1rem 0.5rem;
            }

            .card-content {
                padding: 1rem;
            }

            .login-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <div class="login-icon">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="32" height="32">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
            </div>
            <h1 class="login-title">TrasteroApp</h1>
            <p class="login-subtitle" id="login-subtitle">Introduce tu contrase√±a para acceder</p>
            
            <div id="login-message-container"></div>
            
            <form id="login-form">
                <div class="password-input-container">
                    <input 
                        type="password" 
                        id="login-password" 
                        class="form-input" 
                        placeholder="Contrase√±a" 
                        required
                        autocomplete="current-password"
                    >
                    <button type="button" id="toggle-password" class="password-toggle">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full" id="login-button">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    <span id="login-button-text">Ingresar</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-container hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">Cargando TrasteroApp...</p>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="modal-title">Cambiar Contrase√±a</h2>
            <div id="password-modal-message"></div>
            <form id="password-change-form">
                <div class="form-group">
                    <label for="current-password" class="form-label">Contrase√±a Actual</label>
                    <input 
                        type="password" 
                        id="current-password" 
                        class="form-input" 
                        required
                        autocomplete="current-password"
                    >
                </div>
                <div class="form-group">
                    <label for="new-password" class="form-label">Nueva Contrase√±a</label>
                    <input 
                        type="password" 
                        id="new-password" 
                        class="form-input" 
                        required
                        autocomplete="new-password"
                        minlength="4"
                    >
                </div>
                <div class="form-group">
                    <label for="confirm-password" class="form-label">Confirmar Nueva Contrase√±a</label>
                    <input 
                        type="password" 
                        id="confirm-password" 
                        class="form-input" 
                        required
                        autocomplete="new-password"
                        minlength="4"
                    >
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Cambiar Contrase√±a</button>
                    <button type="button" id="cancel-password-change" class="btn btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <div class="header-content">
                    <div class="header-brand">
                        <div class="header-icon">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="32" height="32">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 21l0-12"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="header-title">TrasteroApp</h1>
                            <p class="header-subtitle">Gestiona tus objetos personales en casa</p>
                        </div>
                    </div>
                    
                    <div class="header-actions">
                        <div class="header-stats">
                            <div class="stats-item">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10"></path>
                                </svg>
                                <span>Total: <span class="stats-number" id="total-items">0</span> objetos</span>
                            </div>
                        </div>
                        
                        <button id="change-password-btn" class="logout-btn">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                            </svg>
                            Cambiar Contrase√±a
                        </button>
                        
                        <button id="logout-btn" class="logout-btn">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            Cerrar Sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-container">
            <div class="content">
                <!-- Add Item Form -->
                <div class="card">
                    <div class="card-content">
                        <h2 class="card-title">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Agregar Nuevo Objeto
                        </h2>
                        
                        <form id="add-item-form" class="form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="item-name" class="form-label">Nombre del Objeto</label>
                                    <input 
                                        type="text" 
                                        id="item-name" 
                                        class="form-input"
                                        placeholder="Ej: Libros de cocina" 
                                        required
                                    >
                                </div>
                                
                                <div class="form-group">
                                    <label for="item-location" class="form-label">Ubicaci√≥n</label>
                                    <input 
                                        type="text" 
                                        id="item-location" 
                                        class="form-input"
                                        placeholder="Ej: Estanter√≠a cocina, estante superior" 
                                        required
                                    >
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-full" id="add-button">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Agregar Objeto
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Items List -->
                <div class="card">
                    <div class="card-content">
                        <h2 class="card-title">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            Mis Objetos
                        </h2>
                        
                        <!-- Search and Filter -->
                        <div class="search-container">
                            <input 
                                type="text" 
                                id="search-input" 
                                class="search-input" 
                                placeholder="Buscar objetos..."
                            >
                        </div>
                        
                        <!-- Items Container -->
                        <div id="items-container" class="items-container">
                            <!-- Items will be inserted here dynamically -->
                        </div>
                        
                        <!-- Export/Import Section -->
                        <div class="export-import-section">
                            <button id="export-btn" class="export-btn">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Exportar Datos
                            </button>
                            
                            <label for="import-input" class="import-btn">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                </svg>
                                Importar Datos
                            </label>
                            <input type="file" id="import-input" class="file-input" accept=".json">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Utility functions for encryption (basic)
        function encryptPassword(password) {
            // Simple Base64 encoding for basic protection
            // In a real app, use proper encryption
            return btoa(password + 'trastero_salt_2024');
        }

        function verifyPassword(inputPassword, storedHash) {
            return encryptPassword(inputPassword) === storedHash;
        }

        // Authentication Manager
        class AuthManager {
            constructor() {
                this.isAuthenticated = false;
                this.sessionTimeout = 30 * 60 * 1000; // 30 minutes in milliseconds
                this.sessionTimer = null;
            }

            // Check if user is already authenticated
            checkAuthStatus() {
                const lastAuth = localStorage.getItem('trastero_last_auth');
                const sessionToken = sessionStorage.getItem('trastero_session');
                
                if (lastAuth && sessionToken) {
                    const lastAuthTime = parseInt(lastAuth);
                    const now = Date.now();
                    
                    if (now - lastAuthTime < this.sessionTimeout) {
                        this.isAuthenticated = true;
                        this.startSessionTimer();
                        return true;
                    } else {
                        this.logout();
                    }
                }
                
                return false;
            }

            // Check if password exists
            hasPassword() {
                return localStorage.getItem('trastero_password') !== null;
            }

            // Set up new password
            setupPassword(password) {
                if (password.length < 4) {
                    throw new Error('La contrase√±a debe tener al menos 4 caracteres');
                }
                
                const hashedPassword = encryptPassword(password);
                localStorage.setItem('trastero_password', hashedPassword);
                return true;
            }

            // Authenticate user
            authenticate(password) {
                const storedPassword = localStorage.getItem('trastero_password');
                
                if (!storedPassword) {
                    throw new Error('No hay contrase√±a configurada');
                }

                if (verifyPassword(password, storedPassword)) {
                    this.isAuthenticated = true;
                    localStorage.setItem('trastero_last_auth', Date.now().toString());
                    sessionStorage.setItem('trastero_session', 'active');
                    this.startSessionTimer();
                    return true;
                } else {
                    throw new Error('Contrase√±a incorrecta');
                }
            }

            // Change password
            changePassword(currentPassword, newPassword) {
                if (!this.isAuthenticated) {
                    throw new Error('No autenticado');
                }

                const storedPassword = localStorage.getItem('trastero_password');
                
                if (!verifyPassword(currentPassword, storedPassword)) {
                    throw new Error('Contrase√±a actual incorrecta');
                }

                if (newPassword.length < 4) {
                    throw new Error('La nueva contrase√±a debe tener al menos 4 caracteres');
                }

                const hashedPassword = encryptPassword(newPassword);
                localStorage.setItem('trastero_password', hashedPassword);
                return true;
            }

            // Start session timer
            startSessionTimer() {
                this.clearSessionTimer();
                
                this.sessionTimer = setTimeout(() => {
                    this.logout();
                    this.showMessage('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.', 'error');
                    this.showLoginScreen();
                }, this.sessionTimeout);
            }

            // Clear session timer
            clearSessionTimer() {
                if (this.sessionTimer) {
                    clearTimeout(this.sessionTimer);
                    this.sessionTimer = null;
                }
            }

            // Logout
            logout() {
                this.isAuthenticated = false;
                this.clearSessionTimer();
                localStorage.removeItem('trastero_last_auth');
                sessionStorage.removeItem('trastero_session');
            }

            // Show message
            showMessage(message, type = 'info') {
                // This will be implemented by the UI manager
                console.log(`${type.toUpperCase()}: ${message}`);
            }

            // Show login screen
            showLoginScreen() {
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
            }
        }

        // Login UI Manager
        class LoginUI {
            constructor(authManager, onLoginSuccess) {
                this.authManager = authManager;
                this.onLoginSuccess = onLoginSuccess;
                this.isSetupMode = false;
                
                this.initializeElements();
                this.setupEventListeners();
                this.checkInitialState();
            }

            initializeElements() {
                this.loginScreen = document.getElementById('login-screen');
                this.loginForm = document.getElementById('login-form');
                this.passwordInput = document.getElementById('login-password');
                this.togglePasswordBtn = document.getElementById('toggle-password');
                this.loginButton = document.getElementById('login-button');
                this.loginButtonText = document.getElementById('login-button-text');
                this.loginSubtitle = document.getElementById('login-subtitle');
                this.messageContainer = document.getElementById('login-message-container');
            }

            setupEventListeners() {
                // Login form submission
                this.loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // Password visibility toggle
                this.togglePasswordBtn.addEventListener('click', () => {
                    this.togglePasswordVisibility();
                });

                // Enter key handling
                this.passwordInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.handleLogin();
                    }
                });
            }

            checkInitialState() {
                if (!this.authManager.hasPassword()) {
                    this.enterSetupMode();
                } else {
                    this.enterLoginMode();
                }
            }

            enterSetupMode() {
                this.isSetupMode = true;
                this.loginSubtitle.textContent = 'Configura una contrase√±a para proteger tus datos';
                this.loginButtonText.textContent = 'Configurar Contrase√±a';
                this.passwordInput.placeholder = 'Nueva contrase√±a (m√≠nimo 4 caracteres)';
                this.passwordInput.setAttribute('minlength', '4');
                
                this.showMessage('Primera vez usando TrasteroApp. Configura una contrase√±a para proteger tus datos.', 'setup');
            }

            enterLoginMode() {
                this.isSetupMode = false;
                this.loginSubtitle.textContent = 'Introduce tu contrase√±a para acceder';
                this.loginButtonText.textContent = 'Ingresar';
                this.passwordInput.placeholder = 'Contrase√±a';
                this.passwordInput.removeAttribute('minlength');
            }

            async handleLogin() {
                const password = this.passwordInput.value.trim();
                
                if (!password) {
                    this.showMessage('Por favor, introduce una contrase√±a', 'error');
                    return;
                }

                this.setLoading(true);

                try {
                    if (this.isSetupMode) {
                        if (password.length < 4) {
                            throw new Error('La contrase√±a debe tener al menos 4 caracteres');
                        }
                        
                        this.authManager.setupPassword(password);
                        this.authManager.authenticate(password);
                        this.showMessage('Contrase√±a configurada correctamente', 'success');
                    } else {
                        this.authManager.authenticate(password);
                        this.showMessage('Acceso concedido', 'success');
                    }

                    // Small delay to show success message
                    setTimeout(() => {
                        this.onLoginSuccess();
                    }, 500);

                } catch (error) {
                    this.showMessage(error.message, 'error');
                    this.passwordInput.value = '';
                    this.passwordInput.focus();
                } finally {
                    this.setLoading(false);
                }
            }

            togglePasswordVisibility() {
                const isPassword = this.passwordInput.type === 'password';
                this.passwordInput.type = isPassword ? 'text' : 'password';
                
                const eyeIcon = this.togglePasswordBtn.querySelector('svg');
                if (isPassword) {
                    eyeIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                    `;
                } else {
                    eyeIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    `;
                }
            }

            setLoading(loading) {
                this.loginButton.disabled = loading;
                if (loading) {
                    this.loginButtonText.textContent = 'Procesando...';
                } else {
                    this.loginButtonText.textContent = this.isSetupMode ? 'Configurar Contrase√±a' : 'Ingresar';
                }
            }

            showMessage(message, type = 'info') {
                const messageElement = document.createElement('div');
                messageElement.className = `${type}-message`;
                messageElement.textContent = message;
                
                this.messageContainer.innerHTML = '';
                this.messageContainer.appendChild(messageElement);

                // Auto-hide success messages
                if (type === 'success') {
                    setTimeout(() => {
                        if (this.messageContainer.contains(messageElement)) {
                            this.messageContainer.removeChild(messageElement);
                        }
                    }, 3000);
                }
            }

            reset() {
                this.passwordInput.value = '';
                this.messageContainer.innerHTML = '';
                this.setLoading(false);
                this.checkInitialState();
            }
        }

        // Password Change Modal Manager
        class PasswordChangeModal {
            constructor(authManager) {
                this.authManager = authManager;
                this.initializeElements();
                this.setupEventListeners();
            }

            initializeElements() {
                this.modal = document.getElementById('password-modal');
                this.form = document.getElementById('password-change-form');
                this.currentPasswordInput = document.getElementById('current-password');
                this.newPasswordInput = document.getElementById('new-password');
                this.confirmPasswordInput = document.getElementById('confirm-password');
                this.messageContainer = document.getElementById('password-modal-message');
                this.cancelButton = document.getElementById('cancel-password-change');
            }

            setupEventListeners() {
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handlePasswordChange();
                });

                this.cancelButton.addEventListener('click', () => {
                    this.hide();
                });

                // Close modal when clicking outside
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });

                // Escape key to close modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !this.modal.classList.contains('hidden')) {
                        this.hide();
                    }
                });
            }

            show() {
                this.modal.classList.remove('hidden');
                this.currentPasswordInput.focus();
                this.clearForm();
            }

            hide() {
                this.modal.classList.add('hidden');
                this.clearForm();
            }

            clearForm() {
                this.form.reset();
                this.messageContainer.innerHTML = '';
            }

            async handlePasswordChange() {
                const currentPassword = this.currentPasswordInput.value;
                const newPassword = this.newPasswordInput.value;
                const confirmPassword = this.confirmPasswordInput.value;

                // Validation
                if (!currentPassword || !newPassword || !confirmPassword) {
                    this.showMessage('Todos los campos son obligatorios', 'error');
                    return;
                }

                if (newPassword.length < 4) {
                    this.showMessage('La nueva contrase√±a debe tener al menos 4 caracteres', 'error');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    this.showMessage('Las contrase√±as no coinciden', 'error');
                    return;
                }

                if (currentPassword === newPassword) {
                    this.showMessage('La nueva contrase√±a debe ser diferente a la actual', 'error');
                    return;
                }

                try {
                    this.authManager.changePassword(currentPassword, newPassword);
                    this.showMessage('Contrase√±a cambiada correctamente', 'success');
                    
                    setTimeout(() => {
                        this.hide();
                    }, 1500);

                } catch (error) {
                    this.showMessage(error.message, 'error');
                }
            }

            showMessage(message, type = 'info') {
                const messageElement = document.createElement('div');
                messageElement.className = `${type}-message`;
                messageElement.textContent = message;
                
                this.messageContainer.innerHTML = '';
                this.messageContainer.appendChild(messageElement);
            }
        }

        // Main TrasteroApp Class (with authentication integration)
        class TrasteroApp {
            constructor() {
                this.items = [];
                this.editingId = null;
                this.editValue = '';
                this.deletingId = null;

                // Initialize authentication
                this.authManager = new AuthManager();
                this.authManager.showMessage = (message, type) => this.showGlobalMessage(message, type);
                this.authManager.showLoginScreen = () => this.showLoginScreen();

                // Initialize login UI
                this.loginUI = new LoginUI(this.authManager, () => this.onLoginSuccess());

                // Initialize password change modal
                this.passwordChangeModal = new PasswordChangeModal(this.authManager);

                // Check if already authenticated
                if (this.authManager.checkAuthStatus()) {
                    this.onLoginSuccess();
                } else {
                    this.showLoginScreen();
                }
            }

            showLoginScreen() {
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
                this.loginUI.reset();
            }

            onLoginSuccess() {
                // Hide login screen and show loading
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('loading-screen').classList.remove('hidden');

                // Initialize the main app
                setTimeout(() => {
                    this.initializeMainApp();
                }, 1000);
            }

            initializeMainApp() {
                // Initialize elements
                this.initializeElements();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Load data and render
                this.loadItems();
                this.render();
                this.updateStats();

                // Hide loading screen and show main app
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
            }

            initializeElements() {
                // Form elements
                this.addForm = document.getElementById('add-item-form');
                this.itemNameInput = document.getElementById('item-name');
                this.itemLocationInput = document.getElementById('item-location');
                this.addButton = document.getElementById('add-button');
                
                // Search elements
                this.searchInput = document.getElementById('search-input');
                
                // List elements
                this.itemsContainer = document.getElementById('items-container');
                this.totalItemsElement = document.getElementById('total-items');
                
                // Export/Import elements
                this.exportButton = document.getElementById('export-btn');
                this.importInput = document.getElementById('import-input');

                // Auth elements
                this.logoutButton = document.getElementById('logout-btn');
                this.changePasswordButton = document.getElementById('change-password-btn');
            }

            setupEventListeners() {
                // Add form submission
                this.addForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addItem();
                });

                // Search functionality
                this.searchInput.addEventListener('input', () => {
                    this.render();
                });

                // Export/Import functionality
                this.exportButton.addEventListener('click', () => {
                    this.exportData();
                });

                this.importInput.addEventListener('change', (e) => {
                    this.importData(e);
                });

                // Auth functionality
                this.logoutButton.addEventListener('click', () => {
                    this.logout();
                });

                this.changePasswordButton.addEventListener('click', () => {
                    this.passwordChangeModal.show();
                });

                // Items list event delegation
                this.setupItemsEventDelegation();
            }

            logout() {
                if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                    this.authManager.logout();
                    this.showLoginScreen();
                }
            }

            showGlobalMessage(message, type) {
                // You can implement a global notification system here
                // For now, we'll use a simple alert for critical messages
                if (type === 'error') {
                    alert(message);
                }
            }

            // Generate unique ID
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            // Add new item
            addItem() {
                const name = this.itemNameInput.value.trim();
                const location = this.itemLocationInput.value.trim();

                if (!name || !location) {
                    alert('Por favor, completa todos los campos');
                    return;
                }

                const newItem = {
                    id: this.generateId(),
                    name: name,
                    location: location,
                    dateAdded: new Date().toLocaleDateString('es-ES')
                };

                this.items.unshift(newItem);
                this.saveItems();
                this.render();
                this.updateStats();

                // Clear form
                this.addForm.reset();
                this.itemNameInput.focus();

                // Show success animation
                this.addButton.style.background = '#10b981';
                this.addButton.textContent = '¬°Agregado!';
                setTimeout(() => {
                    this.addButton.style.background = '#2563eb';
                    this.addButton.innerHTML = `
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Agregar Objeto
                    `;
                }, 1000);
            }

            // Get filtered items based on search
            getFilteredItems() {
                const searchTerm = this.searchInput.value.toLowerCase();
                if (!searchTerm) return this.items;

                return this.items.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.location.toLowerCase().includes(searchTerm)
                );
            }

            // Render items list
            render() {
                const filteredItems = this.getFilteredItems();
                
                if (filteredItems.length === 0) {
                    this.renderEmptyState();
                    return;
                }

                const html = filteredItems.map(item => this.renderItem(item)).join('');
                this.itemsContainer.innerHTML = html;
            }

            // Render single item
            renderItem(item) {
                const isEditing = this.editingId === item.id;
                const isDeleting = this.deletingId === item.id;

                if (isDeleting) {
                    return `
                        <div class="item-card confirm-delete">
                            <div class="item-header">
                                <div class="item-name">¬øEliminar "${this.escapeHtml(item.name)}"?</div>
                            </div>
                            <p>Esta acci√≥n no se puede deshacer.</p>
                            <div class="confirm-actions">
                                <button class="btn confirm-btn" data-action="confirm-delete" data-id="${item.id}">
                                    Eliminar
                                </button>
                                <button class="btn cancel-btn" data-action="cancel-delete">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    `;
                }

                if (isEditing) {
                    return `
                        <div class="item-card">
                            <input 
                                type="text" 
                                class="edit-input" 
                                value="${this.escapeHtml(this.editValue)}"
                                data-id="${item.id}"
                                autofocus
                            >
                            <div class="edit-actions">
                                <button class="btn btn-primary" data-action="save-edit">
                                    Guardar
                                </button>
                                <button class="btn btn-secondary" data-action="cancel-edit">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-name">${this.escapeHtml(item.name)}</div>
                            <div class="item-actions">
                                <button class="btn-icon edit" data-action="start-edit" data-id="${item.id}" title="Editar">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button class="btn-icon delete" data-action="start-delete" data-id="${item.id}" title="Eliminar">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="item-location">${this.escapeHtml(item.location)}</div>
                        <div class="item-date">Agregado el ${item.dateAdded}</div>
                    </div>
                `;
            }

            // Render empty state
            renderEmptyState() {
                const searchTerm = this.searchInput.value.trim();
                const message = searchTerm 
                    ? `No se encontraron objetos que coincidan con "${searchTerm}"`
                    : 'No hay objetos registrados a√∫n';

                this.itemsContainer.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="64" height="64">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                        </svg>
                        <p>${message}</p>
                        ${!searchTerm ? '<p class="text-sm">Agrega tu primer objeto usando el formulario de arriba</p>' : ''}
                    </div>
                `;
            }

            // Setup event delegation for items list
            setupItemsEventDelegation() {
                const container = this.itemsContainer;
                
                // Handle button clicks
                container.addEventListener('click', (e) => {
                    const action = e.target.closest('[data-action]')?.dataset.action;
                    const id = e.target.closest('[data-id]')?.dataset.id;
                    
                    if (!action) return;
                    
                    switch (action) {
                        case 'start-edit':
                            this.handleEditStart(id);
                            break;
                        case 'save-edit':
                            this.handleEditSave();
                            break;
                        case 'cancel-edit':
                            this.handleEditCancel();
                            break;
                        case 'start-delete':
                            this.handleDeleteStart(id);
                            break;
                        case 'confirm-delete':
                            this.handleDeleteConfirm(id);
                            break;
                        case 'cancel-delete':
                            this.handleDeleteCancel();
                            break;
                    }
                });
                
                // Handle edit input changes
                container.addEventListener('input', (e) => {
                    if (e.target.matches('input[data-id]')) {
                        this.editValue = e.target.value;
                    }
                });
                
                // Handle edit input key events
                container.addEventListener('keydown', (e) => {
                    if (e.target.matches('input[data-id]')) {
                        if (e.key === 'Enter') {
                            this.handleEditSave();
                        } else if (e.key === 'Escape') {
                            this.handleEditCancel();
                        }
                    }
                });
            }

            // Edit handlers
            handleEditStart(id) {
                if (this.editingId || this.deletingId) return;
                
                const item = this.items.find(item => item.id === id);
                if (!item) return;
                
                this.editingId = id;
                this.editValue = item.name;
                this.render();
            }

            handleEditSave() {
                if (!this.editingId) return;
                
                const newValue = this.editValue.trim();
                if (!newValue) {
                    alert('El nombre no puede estar vac√≠o');
                    return;
                }
                
                const item = this.items.find(item => item.id === this.editingId);
                if (item) {
                    item.name = newValue;
                    this.saveItems();
                }
                
                this.editingId = null;
                this.editValue = '';
                this.render();
            }

            handleEditCancel() {
                this.editingId = null;
                this.editValue = '';
                this.render();
            }

            // Delete handlers
            handleDeleteStart(id) {
                if (this.editingId || this.deletingId) return;
                
                this.deletingId = id;
                this.render();
            }

            handleDeleteConfirm(id) {
                this.items = this.items.filter(item => item.id !== id);
                this.saveItems();
                this.deletingId = null;
                this.render();
                this.updateStats();
            }

            handleDeleteCancel() {
                this.deletingId = null;
                this.render();
            }

            // Data persistence
            saveItems() {
                try {
                    localStorage.setItem('trastero_items', JSON.stringify(this.items));
                } catch (error) {
                    console.error('Error saving items:', error);
                    alert('Error al guardar los datos');
                }
            }

            loadItems() {
                try {
                    const stored = localStorage.getItem('trastero_items');
                    this.items = stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error loading items:', error);
                    this.items = [];
                }
            }

            // Stats
            updateStats() {
                this.totalItemsElement.textContent = this.items.length;
            }

            // Export functionality
            exportData() {
                try {
                    const data = {
                        items: this.items,
                        exportDate: new Date().toISOString(),
                        version: '1.1.0'
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `trastero-datos-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    URL.revokeObjectURL(url);
                    
                    // Show success feedback
                    const originalText = this.exportButton.innerHTML;
                    this.exportButton.innerHTML = `
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        ¬°Exportado!
                    `;
                    
                    setTimeout(() => {
                        this.exportButton.innerHTML = originalText;
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error exporting data:', error);
                    alert('Error al exportar los datos');
                }
            }

            // Import functionality
            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // Validate data structure
                        if (!data.items || !Array.isArray(data.items)) {
                            throw new Error('Formato de archivo inv√°lido');
                        }
                        
                        // Validate items structure
                        const validItems = data.items.filter(item => 
                            item && 
                            typeof item.name === 'string' && 
                            typeof item.location === 'string'
                        );
                        
                        if (validItems.length === 0) {
                            throw new Error('No se encontraron elementos v√°lidos en el archivo');
                        }
                        
                        // Ensure all items have required fields
                        const normalizedItems = validItems.map(item => ({
                            id: item.id || this.generateId(),
                            name: item.name.trim(),
                            location: item.location.trim(),
                            dateAdded: item.dateAdded || new Date().toLocaleDateString('es-ES')
                        }));
                        
                        // Confirm import
                        const confirmMessage = `¬øImportar ${normalizedItems.length} elementos?\n\nEsto reemplazar√° todos los datos actuales.`;
                        
                        if (confirm(confirmMessage)) {
                            this.items = normalizedItems;
                            this.saveItems();
                            this.render();
                            this.updateStats();
                            
                            alert(`Importaci√≥n exitosa: ${normalizedItems.length} elementos importados`);
                        }
                        
                    } catch (error) {
                        console.error('Error importing data:', error);
                        alert('Error al importar: ' + error.message);
                    }
                    
                    // Clear file input
                    event.target.value = '';
                };
                
                reader.readAsText(file);
            }

            // Escape HTML to prevent XSS
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new TrasteroApp();
        });
    </script>
</body>
</html>
